/*!
 * savvior v0.4.2 - A Javascript multicolumn layout tool alternative to Masonry or Salvattore.
 * http://savvior.org
 * https://github.com/attila/savvior
 */
!function(a,b){"object"==typeof exports?module.exports=b(require("enquire")):"function"==typeof define&&define.amd?define("savvior",["enquire"],b):a.savvior=b(a.enquire)}(this,function(a){function b(a,b,c){a.dataset?a.dataset[b]=c:a.setAttribute("data-"+b,c)}function c(a,b){var c,d=0,e=a.length;for(d;e>d&&(c=b(a[d],d),c!==!1);d++);}function d(a){return"function"==typeof a}function e(a,b){for(b in a)return!1;return!0}function f(a){this.columns=null,this.element=a,this.status=!1}function g(a,b){this.selector=a,this.options=b,this.queryHandlers=[],this.grids=[],this.ready=!1}function h(){if(!a)throw new Error("enquire.js not present, please load it before calling any methods");this.grids={}}return"function"!=typeof window.CustomEvent&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}window.CustomEvent=a,a.prototype=window.CustomEvent.prototype}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b,c){var d=(new Date).getTime(),e=Math.max(0,16-(d-a)),f=window.setTimeout(function(){b(d+e)},e);return a=d+e,f}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),f.prototype={setup:function(a,c){if(!this.status){var e=this,f=document.createRange(),g=document.createElement("div");f.selectNodeContents(this.element),g.appendChild(f.extractContents()),window.requestAnimationFrame(function(){b(g,"columns",0),e.addColumns(g,a),e.status=!0,d(c)&&c(e)})}},addColumns:function(a,d){for(var e,f=["column","size-1of"+d],g=document.createDocumentFragment(),h=[],i=d;0!==i--;)e="[data-columns] > *:nth-child("+d+"n-"+i+")",h.push(a.querySelectorAll(e));c(h,function(a){var b=document.createElement("div"),d=document.createDocumentFragment();b.className=f.join(" "),c(a,function(a){d.appendChild(a)}),b.appendChild(d),g.appendChild(b)}),this.element.appendChild(g),b(this.element,"columns",d),this.columns=d},removeColumns:function(){var a,d=document.createRange(),e=this.element;d.selectNodeContents(e),a=Array.prototype.filter.call(d.extractContents().childNodes,function(a){return a instanceof window.HTMLElement});var f=a.length,g=a[0].childNodes.length,h=new Array(g*f);c(a,function(a,b){c(a.children,function(a,c){h[c*f+b]=a})});var i=document.createElement("div");return b(i,"columns",0),h.filter(function(a){return!!a}).forEach(function(a){i.appendChild(a)}),i},redraw:function(a,b){var c=this,e={element:c.element,from:c.columns,to:a},f=new CustomEvent("savvior:redraw",{detail:e});window.requestAnimationFrame(function(){c.columns!==a&&c.addColumns(c.removeColumns(),a),window.dispatchEvent(f),d(b)&&b(c)})},restore:function(a){if(!this.status)return d(a)&&a(!1),!1;var b=this,e={element:b.element,from:b.columns};window.requestAnimationFrame(function(){var f=document.createDocumentFragment(),g=b.removeColumns(),h=[],i=new CustomEvent("savvior:restore",{detail:e});c(g.childNodes,function(a){h.push(a)}),h.forEach(function(a){f.appendChild(a)}),b.element.appendChild(f),b.element.removeAttribute("data-columns"),window.dispatchEvent(i),d(a)&&a(b)})}},g.prototype={register:function(){var b=document.querySelectorAll(this.selector),d=this;c(b,function(a){d.grids.push(new f(a))});for(var e in this.options){var g=this.constructHandler(e,this.options[e]);this.queryHandlers.push(g)}return c(this.queryHandlers,function(b){a.register(b.mq,b.handler)}),this.ready=!0,this},constructHandler:function(a){var b=this;return{mq:a,handler:{deferSetup:!0,setup:function(){b.gridSetup(a)},match:function(){b.gridMatch(a)},destroy:function(){}}}},gridSetup:function(a){var b=this;c(this.grids,function(c){c.setup(b.options[a].columns,function(){var a={element:c?c.element:null,columns:c?c.columns:null},b=new CustomEvent("savvior:setup",{detail:a});window.dispatchEvent(b)})})},gridMatch:function(a){var b=this;c(this.grids,function(c){var d={element:c.element,from:c.columns,to:b.options[a].columns,query:a},e=new CustomEvent("savvior:match",{detail:d});c.redraw(b.options[a].columns,function(){window.dispatchEvent(e)})})},unregister:function(b){c(this.queryHandlers,function(b){var c=b.callbacks?b.callbacks:void 0;a.unregister(b.mq,c)});var e=this;c(this.grids,function(a){a.restore(function(){e.queryHandlers=[],e.ready=!1,d(b)&&b(e)})}),e.grids=[]}},h.prototype={init:function(a,b){if("string"!=typeof a)throw new Error("Selector must be a string");if("object"!=typeof b)throw new Error("Options must be an object");var c=new CustomEvent("savvior:init"),d=this.grids;return d[a]=new g(a,b),d[a].selector=a,d[a].register(b),window.dispatchEvent(c),this},destroy:function(a,b){var f=new CustomEvent("savvior:destroy"),g=this,h=void 0===a||e(a)?Object.keys(this.grids):a,i=h.length,j=0,k=function(a){delete g.grids[h[j]],++j===i&&(window.dispatchEvent(f),d(b)&&b(a))};c(h,function(a){void 0!==g.grids[a]&&g.grids[a].unregister(k)})},ready:function(a){if(void 0===a){var b=[];for(var c in this.grids)this.grids[c].ready&&b.push(c);return b.length>0?b:!1}return this.grids[a]?this.grids[a].ready:!1}},new h});