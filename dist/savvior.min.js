/*!
 * savvior v0.2.1 - A Salvattore or Masonry alternative for multi column layouts.
 * http://savvior.org
 * https://github.com/attila/savvior
 */
!function(a,b){"object"==typeof exports?module.exports=b(require("enquire")):"function"==typeof define&&define.amd?define("savvior",["enquire"],b):a.savvior=b(a.enquire)}(this,function(a){function b(a,b,c){a.dataset?a.dataset[b]=c:a.setAttribute("data-"+b,c)}function c(a,b){var c,d=0,e=a.length;for(d;e>d&&(c=b(a[d],d),c!==!1);d++);}function d(a){this.columns=null,this.element=a,this.status=!1}function e(a,b){this.selector=a,this.options=b,this.queryHandlers=[],this.grid={},this.ready=!1}function f(){if(!a)throw new Error("enquire.js not present, please load it before calling any methods");this.grids={}}return"function"!=typeof window.CustomEvent&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}window.CustomEvent=a,a.prototype=window.CustomEvent.prototype}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),d.prototype={setup:function(a){if("none"!==window.getComputedStyle(this.element).display){if(!this.status){var c=document.createRange(),d=document.createElement("div");c.selectNodeContents(this.element),d.appendChild(c.extractContents()),b(d,"columns",0),this.addColumns(d,a),this.status=!0}return this}},addColumns:function(a,d){for(var e,f=["column","size-1of"+d],g=document.createDocumentFragment(),h=[],i=d;0!==i--;)e="[data-columns] > *:nth-child("+d+"n-"+i+")",h.push(a.querySelectorAll(e));c(h,function(a){var b=document.createElement("div"),d=document.createDocumentFragment();b.className=f.join(" "),c(a,function(a){d.appendChild(a)}),b.appendChild(d),g.appendChild(b)}),this.element.appendChild(g),b(this.element,"columns",d),this.columns=d},removeColumns:function(){var a,d=document.createRange(),e=this.element;d.selectNodeContents(e),a=Array.prototype.filter.call(d.extractContents().childNodes,function(a){return a instanceof window.HTMLElement});var f=a.length,g=a[0].childNodes.length,h=new Array(g*f);c(a,function(a,b){c(a.children,function(a,c){h[c*f+b]=a})});var i=document.createElement("div");return b(i,"columns",0),h.filter(function(a){return!!a}).forEach(function(a){i.appendChild(a)}),i},redraw:function(a){var b=this;b.columns!==a&&window.requestAnimationFrame(function(){var c=new CustomEvent("savvior:redraw",{detail:b.element});b.addColumns(b.removeColumns(),a),window.dispatchEvent(c)})},restore:function(){if(this.status){var a=this;window.requestAnimationFrame(function(){var b=document.createDocumentFragment(),d=a.removeColumns(),e=[],f=new CustomEvent("savvior:restore",{detail:a.element});return c(d.childNodes,function(a){e.push(a)}),e.forEach(function(a){b.appendChild(a)}),a.element.appendChild(b),a.element.removeAttribute("data-columns"),window.dispatchEvent(f),a})}}},e.prototype={register:function(){var b=document.querySelector(this.selector);if("none"!==window.getComputedStyle(b).display){this.grid=new d(b,this.selector);for(var e in this.options){var f=this.constructHandler(e,this.options[e]);this.queryHandlers.push(f)}return c(this.queryHandlers,function(b){a.register(b.mq,b.handler)}),this.ready=!0,this}},constructHandler:function(a){var b=this;return{mq:a,handler:{deferSetup:!0,setup:function(){b.gridSetup(a)},match:function(){b.gridMatch(a)},destroy:function(){}}}},gridSetup:function(a){this.grid.status||this.grid.setup(this.options[a].columns)},gridMatch:function(a){this.grid.redraw(this.options[a].columns)},unregister:function(){c(this.queryHandlers,function(b){a.unregister(b.mq,b.callbacks)}),this.grid.restore(),this.queryHandlers=[],delete this.grid,this.ready=!1}},f.prototype={init:function(a,b){if(void 0===typeof b)return!1;var c=new CustomEvent("savvior:init"),d=this.grids;return d[a]||(d[a]=new e(a,b),d[a].selector=a),d[a].register(b),window.dispatchEvent(c),this},destroy:function(a){return this.grids[a]?(this.grids[a].unregister(),delete this.grids[a],this):!1},ready:function(a){return this.grids[a]?this.grids[a].ready:void 0}},new f});