/*!
 * savvior-lite v0.3.0 - A Javascript multicolumn layout tool alternative to Masonry or Salvattore.
 * http://savvior.org
 * https://github.com/attila/savvior
 */
!function(a,b){"object"==typeof exports?module.exports=b():"function"==typeof define&&define.amd?define("savvior-lite",[],b):a["savvior-lite"]=b()}(this,function(){function a(a,b,c){a.dataset?a.dataset[b]=c:a.setAttribute("data-"+b,c)}function b(a,b){var c,d=0,e=a.length;for(d;e>d&&(c=b(a[d],d),c!==!1);d++);}function c(a){return"function"==typeof a}function d(a){this.columns=null,this.element=a,this.status=!1}function e(){this.selector=null,this.options=null,this.grid={},this.ready=!1}return"function"!=typeof window.CustomEvent&&!function(){function a(a,b){b=b||{bubbles:!1,cancelable:!1,detail:void 0};var c=document.createEvent("CustomEvent");return c.initCustomEvent(a,b.bubbles,b.cancelable,b.detail),c}window.CustomEvent=a,a.prototype=window.CustomEvent.prototype}(),function(){for(var a=0,b=["ms","moz","webkit","o"],c=0;c<b.length&&!window.requestAnimationFrame;++c)window.requestAnimationFrame=window[b[c]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[b[c]+"CancelAnimationFrame"]||window[b[c]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(b){var c=(new Date).getTime(),d=Math.max(0,16-(c-a)),e=window.setTimeout(function(){b(c+d)},d);return a=c+d,e}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(a){clearTimeout(a)})}(),d.prototype={setup:function(b,d){if(!this.status||"none"!==window.getComputedStyle(this.element).display){var e=this,f=document.createRange(),g=document.createElement("div");f.selectNodeContents(this.element),g.appendChild(f.extractContents()),window.requestAnimationFrame(function(){a(g,"columns",0),e.addColumns(g,b),e.status=!0,c(d)&&d(e)})}},addColumns:function(c,d){for(var e,f=["column","size-1of"+d],g=document.createDocumentFragment(),h=[],i=d;0!==i--;)e="[data-columns] > *:nth-child("+d+"n-"+i+")",h.push(c.querySelectorAll(e));b(h,function(a){var c=document.createElement("div"),d=document.createDocumentFragment();c.className=f.join(" "),b(a,function(a){d.appendChild(a)}),c.appendChild(d),g.appendChild(c)}),this.element.appendChild(g),a(this.element,"columns",d),this.columns=d},removeColumns:function(){var c,d=document.createRange(),e=this.element;d.selectNodeContents(e),c=Array.prototype.filter.call(d.extractContents().childNodes,function(a){return a instanceof window.HTMLElement});var f=c.length,g=c[0].childNodes.length,h=new Array(g*f);b(c,function(a,c){b(a.children,function(a,b){h[b*f+c]=a})});var i=document.createElement("div");return a(i,"columns",0),h.filter(function(a){return!!a}).forEach(function(a){i.appendChild(a)}),i},redraw:function(a,b){var d=this,e={element:d.element,from:d.columns,to:a},f=new CustomEvent("savvior:redraw",{detail:e});window.requestAnimationFrame(function(){d.columns!==a&&d.addColumns(d.removeColumns(),a),window.dispatchEvent(f),c(b)&&b(d)})},restore:function(a){if(!this.status)return c(a)&&a(!1),!1;var d=this,e={element:d.element,from:d.columns};window.requestAnimationFrame(function(){var f=document.createDocumentFragment(),g=d.removeColumns(),h=[],i=new CustomEvent("savvior:restore",{detail:e});b(g.childNodes,function(a){h.push(a)}),h.forEach(function(a){f.appendChild(a)}),d.element.appendChild(f),d.element.removeAttribute("data-columns"),window.dispatchEvent(i),c(a)&&a(d)})}},e.prototype={init:function(a,b){if(void 0===a||void 0===b)return!1;var c=document.querySelector(a);if("undefined"==typeof window.getComputedStyle||"none"!==window.getComputedStyle(c).display){this.options=b,this.selector=a,this.grid=new d(c,this.selector);var e=this;return e.grid.status||e.grid.setup(this.options.columns,function(){var a={element:e.grid?e.grid.element:null,columns:e.grid?e.grid.columns:null},b=new CustomEvent("savvior-lite:init",{detail:a});window.dispatchEvent(b)}),this.ready=!0,this}},destroy:function(a){var b=this;this.grid.restore(function(){b.queryHandlers=[],delete b.grid,b.ready=!1,c(a)&&a(b)})}},new e});